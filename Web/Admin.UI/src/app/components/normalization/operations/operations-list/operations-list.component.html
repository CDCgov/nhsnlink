<div class="button-row">
  <button type="button" class="link-button primary" aria-label="Open operation sequence" (click)="openOperationSequenceDialog()">
    Sequence Facility/Vendor Operations
  </button>

  <span class="spacer"></span>

  <button type="button" class="link-button primary" aria-label="Reload operations" (click)="onRefresh()">
    <fa-icon [icon]="faRotate"></fa-icon>
    Refresh
  </button>
</div>

@if (operations.length > 0) {
  <div>
    <table mat-table [dataSource]="operations" class="full-width-table">
      <!-- Operation Type Column -->
      <ng-container matColumnDef="operationType">
        <th mat-header-cell *matHeaderCellDef>Operation Type</th>
        <td mat-cell *matCellDef="let op">{{ op.operationType }}</td>
      </ng-container>
      <ng-container matColumnDef="operationId">
        <th mat-header-cell *matHeaderCellDef>Operation Id</th>
        <td mat-cell *matCellDef="let op">{{ op.id }}</td>
      </ng-container>
      <!-- Name Column -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Name</th>
        <td mat-cell *matCellDef="let op">{{ op.name }}</td>
      </ng-container>
      <!-- Description Column -->
      <ng-container matColumnDef="description">
        <th mat-header-cell *matHeaderCellDef>Description</th>
        <td mat-cell *matCellDef="let op">{{ op.description }}</td>
      </ng-container>
      <!-- Resource Types Column -->
      <ng-container matColumnDef="resourceTypes">
        <th mat-header-cell *matHeaderCellDef>Resource Types</th>
        <td mat-cell *matCellDef="let op">
          @if (op.resourceTypes?.length) {
            @for (resourceType of op.resourceTypes; track resourceType; let isLast = $last) {
              <span>{{ resourceType }}</span>@if (!isLast) {
              <span>, </span>
            }
          }
        } @else {
          <span class="text-muted">None</span>
        }
      </td>
    </ng-container>
    <!-- Is Disabled Column -->
    <ng-container matColumnDef="isDisabled">
      <th mat-header-cell *matHeaderCellDef>Enabled</th>
      <td mat-cell *matCellDef="let op" class="enabled-column">
        {{ op.isDisabled ? 'No' : 'Yes' }}
      </td>
    </ng-container>
    <!-- Operation JSON Column with Pop-Up -->
    <ng-container matColumnDef="operationJson">
      <th mat-header-cell *matHeaderCellDef> Operation JSON</th>
      <td mat-cell *matCellDef="let op">
        <button mat-icon-button class="visibility-column" matTooltip="Show Operation in Json format"
          (click)="openJsonDialog(op)" aria-label="Show Json">
          <mat-icon>visibility</mat-icon>
        </button>
      </td>
    </ng-container>
    <!-- Actions Column -->
    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>Actions</th>
      <td mat-cell *matCellDef="let op">
        <button mat-icon-button class="edit-column" matTooltip="Edit Operation Configuration"
          (click)="showOperationDialog(op)" aria-label="Edit operation">
          <mat-icon>edit</mat-icon>
        </button>
        <button mat-icon-button class="delete-column" aria-label="Delete facility" title="Delete operation"
          matTooltip="Delete Operation" (click)="$event.stopPropagation();onDelete(op)">
          <mat-icon>delete</mat-icon>
        </button>
        <button mat-icon-button class="test-column" matTooltip="Test Operation" aria-label="Test Operation" (click)="openTestDialog(op)">
          <mat-icon>play_arrow</mat-icon>
        </button>
      </td>
    </ng-container>
    <!-- Table Header and Row Declarations -->
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>
  <mat-paginator [length]="paginationMetadata.totalCount"
    [pageIndex]="paginationMetadata.pageNumber"
    [pageSize]="paginationMetadata.pageSize"
    [pageSizeOptions]="[5, 10, 20]"
    (page)="pagedEvent($event)"
    showFirstLastButtons=""
    aria-label="Select page of operations">
  </mat-paginator>
</div>
} @else {
  <div class="no-results">
    <h2 class="no-results-title">No Operations Found</h2>
  </div>
}

