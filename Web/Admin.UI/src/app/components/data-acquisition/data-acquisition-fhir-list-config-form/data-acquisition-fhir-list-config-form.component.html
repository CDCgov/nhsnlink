<form [formGroup]="configForm" class="dialog-form">
  <div class="form-input">
    <mat-form-field appearance="outline" class="subject-input form-input ">
      <mat-label>Facility Id</mat-label>
      <input matInput formControlName="facilityId" [disabled]="true" placeholder="Facility Id">
    </mat-form-field>
  </div>

  <div class="form-input">
    <mat-form-field appearance="outline" class="subject-input form-input ">
      <mat-label>Fhir Server Base Url</mat-label>
      <input matInput formControlName="fhirServerBaseUrl" [disabled]="viewOnly" placeholder="Fhir Server Base URL">
      @if (fhirServerBaseUrlControl.value && !viewOnly) {
        <button matSuffix mat-icon-button aria-label="Clear"
                (click)="clearFhirServerBaseUrl()">
          <mat-icon>close</mat-icon>
        </button>
      }
      @if (!viewOnly && fhirServerBaseUrlControl.hasError('required')) {
        <mat-error>
          A fhir server base url is <strong>required</strong>
        </mat-error>
      }
    </mat-form-field>
  </div>

  <div formArrayName="patientListControl">
    <!-- Header Row -->
    <div class="patient-row header-row">
      <div class="column">Status</div>
      <div class="column">Time Frame</div>
      <div class="column">FhirId</div>
    </div>

    @for (patientForm of patientListControl.controls; track patientForm; let i = $index) {
      <div [formGroup]="patientForm" class="patient-container">
        <!-- Value Row -->
        <div class="patient-row value-row">
          <div class="column">{{ patientForm.get('status')?.value }}</div>
          <div class="column">{{ patientForm.get('timeFrame')?.value }}</div>
          <div class="column">
            <mat-form-field appearance="outline" class="form-input fhir-field">
              <input
                [readonly]="viewOnly"
                matInput
                formControlName="fhirId"
                placeholder="FhirId"
              />
              <!-- Error messages -->
              @if (patientForm.get('fhirId')?.hasError('required') && (patientForm.get('fhirId')?.touched || patientForm.get('fhirId')?.value == '')){
                <mat-error>
                  FhirId is required
                </mat-error>
              }
              @if (patientForm.get('fhirId')?.hasError('duplicate')) {
                <mat-error>Duplicate FhirId</mat-error>
              }
            </mat-form-field>
          </div>

          @if (!viewOnly){
            <button mat-icon-button type="button" (click)="clearFhirId(patientForm)">
              <mat-icon>close</mat-icon>
            </button>
          }
        </div>
      </div>
    }
  </div>
</form>


