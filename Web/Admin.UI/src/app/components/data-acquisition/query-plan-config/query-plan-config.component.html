<form [formGroup]="planForm" class="dialog-form">

  <div>
    <mat-form-field class="form-select" appearance="outline">
      <mat-label>Type</mat-label>
      <mat-select matInput formControlName="type" (selectionChange)="onTypeChange($event)">
        @for (type of types; track type) {
          <mat-option [disabled] = "!viewOnly" [value]="type.value">
            {{ type.label }}
          </mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>

  <div class="form-input">
    <mat-form-field appearance="outline" class="subject-input form-input ">
      <mat-label>Facility Id</mat-label>
      <input matInput formControlName="facilityId" [disabled]="true" placeholder="Facility Id">
    </mat-form-field>
  </div>

  <div class="form-input">
    <mat-form-field appearance="outline" class="subject-input form-input ">
      <mat-label>Plan Name</mat-label>
      <input matInput formControlName="planName" [readonly]="viewOnly" placeholder="Plan Name">
      @if (planNameControl.value && !viewOnly) {
        <button matSuffix mat-icon-button aria-label="Clear"
          (click)="clearPlanName()">
          <mat-icon>close</mat-icon>
        </button>
      }
      @if ( !viewOnly && planNameControl.hasError('required')) {
        <mat-error>
          A plan name is <strong>required</strong>
        </mat-error>
      }
    </mat-form-field>
  </div>

  <div class="form-input">
    <mat-form-field appearance="outline" class="subject-input form-input">
      <mat-label>Ehr Description</mat-label>
      <input matInput formControlName="ehrDescription" [readonly]="viewOnly" placeholder="Ehr Description">
      @if (ehrDescriptionControl.value && !viewOnly) {
        <button matSuffix mat-icon-button aria-label="Clear"
          (click)="clearEhrDescription()">
          <mat-icon>close</mat-icon>
        </button>
      }
      @if ( !viewOnly && ehrDescriptionControl.hasError('required')) {
        <mat-error>
          An Ehr description is <strong>required</strong>
        </mat-error>
      }
    </mat-form-field>
  </div>

  <div class="form-input">
    <mat-form-field appearance="outline" class="subject-input form-input">
      <mat-label>Look Back</mat-label>
      <input matInput formControlName="lookBack" [readonly]="viewOnly" placeholder="Look Back">
      @if (lookBackControl.value && !viewOnly) {
        <button matSuffix mat-icon-button aria-label="Clear"
          (click)="clearLookBack()">
          <mat-icon>close</mat-icon>
        </button>
      }
      @if ( !viewOnly && lookBackControl.hasError('required')) {
        <mat-error>
          A look back is <strong>required</strong>
        </mat-error>
      }
    </mat-form-field>
  </div>

  <div class="form-input">
    <mat-form-field appearance="outline" class="subject-input form-input">
      <mat-label>Initial Queries</mat-label>
      <textarea class="large-textarea" rows="10" matInput formControlName="initialQueries"
      [readonly]="viewOnly"></textarea>
      @if (initialQueriesControl.value && !viewOnly) {
        <button matSuffix mat-icon-button aria-label="Clear"
          (click)="clearInitialQueries()">
          <mat-icon>close</mat-icon>
        </button>
      }
      @if ( !viewOnly && initialQueriesControl.hasError('required')) {
        <mat-error>
          Initial Queries string is required <strong>required</strong>
        </mat-error>
      }
      @if (!viewOnly && initialQueriesControl.hasError('invalidJson')) {
        <mat-error>
          ❌ Invalid JSON format.
        </mat-error>
      }
    </mat-form-field>
  </div>

  <div class="form-input">
    <mat-form-field appearance="outline" class="subject-input form-input">
      <mat-label>Supplemental Queries</mat-label>
      <textarea class="large-textarea" rows="10" matInput formControlName="supplementalQueries"
      [readonly]="viewOnly"></textarea>
      @if (supplementalQueriesControl.value && !viewOnly) {
        <button matSuffix mat-icon-button aria-label="Clear"
          (click)="clearSupplementalQueries()">
          <mat-icon>close</mat-icon>
        </button>
      }
      @if ( !viewOnly && supplementalQueriesControl.hasError('required')) {
        <mat-error>
          Supplemental Queries string is required <strong>required</strong>
        </mat-error>
      }
      @if (!viewOnly && supplementalQueriesControl.hasError('invalidJson')) {
        <mat-error>
          ❌ Invalid JSON format.
        </mat-error>
      }
    </mat-form-field>
  </div>

</form>
